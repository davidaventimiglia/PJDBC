import java.sql.*;
import java.util.regex.*;
import org.pjdbc.drivers.*;
getClass("org.pjdbc.drivers.MockDriver");
getClass("org.pjdbc.drivers.FilterDriver");
DriverManager
    .getDriver("jdbc:filter:jdbc:mock:foo")
    .setFilter(new FilterDriver.Filter() {
	    public String apply (String sql) {
		Matcher m1 = Pattern.compile("CREATE\\s+ASSERTION\\s+(\\w+)\\s+CHECK\\s+(.*)").matcher((""+sql).trim().toUpperCase());
		if (m1.matches()) {
		    Matcher m2 = Pattern.compile("\\((.*)=(.*)\\)").matcher(m1.group(2));
		    if (m2.matches()) {
			return m1.group(1) + "," + m2.group(1) + "," + m2.group(2);}}
		return sql;}});
DriverManager
    .getConnection("jdbc:filter:jdbc:mock:foo")
    .createStatement()
    .executeQuery("create assertion foo check (0=(select count(*) from person))");
String log = ((MockDriver)DriverManager.getDriver("jdbc:mock:foo")).getLog("jdbc:mock:foo");
assertEquals("executeQuery[FOO,0,(SELECT COUNT(*) FROM PERSON)]", log);
