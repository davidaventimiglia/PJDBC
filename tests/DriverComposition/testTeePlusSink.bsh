#!/bin/sh
set -e
bsh -classpath pjdbc.jar <<EOF
    try {
	source("tests/init.bsh");
	import java.sql.*;
	import org.pjdbc.drivers.*;
	getClass("org.pjdbc.drivers.MockDriver");
	getClass("org.pjdbc.drivers.SinkDriver");
	getClass("org.pjdbc.drivers.TeeDriver");
	Connection c = DriverManager.getConnection("jdbc:tee:jdbc:mock:foo;jdbc:sink:jdbc:mock:bar");
	MockDriver foo = (MockDriver)DriverManager.getDriver("jdbc:mock:foo");
	MockDriver bar = (MockDriver)DriverManager.getDriver("jdbc:mock:bar");
	assertSame(foo, bar);
	Statement stmt = c.createStatement();
	stmt.executeQuery("select * from person;");
	stmt.executeQuery("insert into person (last_name, first_name, age) values ('David', 'Ventimiglia', 42);");
	assertNotNull(foo.getLog("jdbc:mock:foo"));
	assertNotNull(bar.getLog("jdbc:mock:bar"));
	assertEquals("executeQuery[select * from person;]\n"+
		     "executeQuery[insert into person (last_name, first_name, age) values ('David', 'Ventimiglia', 42);]", 
		     foo.getLog("jdbc:mock:foo"));
	assertEquals("", bar.getLog("jdbc:mock:bar"));
    } catch (e) {System.exit(1);}
EOF

# Local Variables:
# mode: java
# End:
